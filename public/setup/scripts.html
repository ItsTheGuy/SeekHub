<!--
  SeekHub
  Copyright (C) 2021 ItsTheGuy

  This program is free software: you can redistribute it and/or modify
  it under the terms of the GNU General Public License as published by
  the Free Software Foundation, either version 3 of the License, or
  any later version.

  This program is distributed in the hope that it will be useful,
  but WITHOUT ANY WARRANTY; without even the implied warranty of
  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  GNU General Public License for more details.

  You should have received a copy of the GNU General Public License
  along with this program.  If not, see <https://www.gnu.org/licenses/>.
-->

<script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
<script defer>
    let unloadConfirmedByUser = false;
    function finishSetup() {
        event.preventDefault();
        const setupData = JSON.stringify($("#setup").serializeArray());
        $.ajax({
          type: "POST",
          url: "/setup",
          data: setupData,
          success: function(data){
            const elementsForm = ["title", "name", "navTitle", "legalNotice"]
            for (const i in elementsForm) {
              document.getElementById('subtitle').innerHTML = "Now save your master key safely, don't share it with anyone!"
              document.getElementById(`${elementsForm[i]}Container`).style.display = "none";
              document.getElementById(`${elementsForm[i]}Input`).readOnly = true;
            }
            document.getElementById("masterKeyContainer").style.display = "block";
            document.getElementById("masterKeyInput").setAttribute("value", data["masterKey"]);
            document.getElementById("submitButton").onclick = function() {
              event.preventDefault();
              if (confirm("Are you sure you want to continue? You won't be able to obtain the master key later!") == true) {
                unloadConfirmedByUser = true;
                location.reload();
              }
            };
            document.getElementById("submitButton").setAttribute("value", "Finish!");
          },
          dataType: "json",
          contentType : "application/json"
        });
    }    

    window.onbeforeunload = function() { if (!unloadConfirmedByUser) event.preventDefault(); }
</script>